*** Bug #27997 ***
SET @@storage_engine = 'Falcon';
DROP TABLE IF EXISTS t1;
SET @@autocommit = 0;
CREATE TABLE t1 (a int, b int);
CREATE UNIQUE INDEX i1 on t1 (a, b);
INSERT INTO t1 VALUES (5, NULL), (5, NULL);
COMMIT;
SELECT * FROM t1 FOR UPDATE;
a	b
5	NULL
5	NULL
UPDATE t1 SET b = 2;
ERROR 23000: Duplicate entry '5-2' for key 'i1'
COMMIT;
UPDATE t1 SET b = 2;
ERROR 23000: Duplicate entry '5-2' for key 'i1'
COMMIT;
UPDATE t1 SET a = 3, b = 2 WHERE a = 5 LIMIT 1;
COMMIT;
SELECT count(*) FROM t1;
count(*)
2
SELECT count(*) FROM t1 WHERE a = 5;
count(*)
1
SELECT count(*) FROM t1 WHERE a = 3;
count(*)
1
COMMIT;
DROP TABLE t1;
