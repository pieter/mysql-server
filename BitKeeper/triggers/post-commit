#!/bin/sh

#shift
TO=dev@mysql.com
FROM=$USER@mysql.com
LIMIT=10000

if [ "$REAL_EMAIL" = "" ]
then
 echo "Warning: you must set REAL_EMAIL in your profile"
else
 FROM=$REAL_EMAIL 
fi

BK_STATUS=$BK_STATUS$BK_COMMIT

if [ "$BK_STATUS" = OK ]
then 
 echo "Commit successful, notifying developers at $TO"
 (
   cat <<EOF
List-ID: <bk.mysql>
From: $FROM
To: $TO
Subject: bk commit

EOF
  bk changes -v -r+
  bk cset -r+ -d
 ) | head -n $LIMIT | /usr/sbin/sendmail -t
else
 echo "commit failed because '$BK_STATUS', sorry life is hard..." 
fi
