# This test checks that the slave I/O thread refuses to start if slave
# and master have the same server id (because this is a useless setup,
# and otherwise SHOW SLAVE STATUS shows progress but all queries are
# ignored, which has caught our customers), unless
# --replicate-same-server-id.

source include/master-slave.inc;
connection slave;
reset master;

# replicate ourselves
stop slave;
--replace_result $SLAVE_MYPORT SLAVE_PORT
eval change master to master_port=$SLAVE_MYPORT;
start slave;

--echo *** must be having the replicate-same-server-id IO thread error ***

source include/wait_for_slave_io_to_stop.inc;

--replace_result $SLAVE_MYPORT SLAVE_PORT
--replace_column 12 # 16 # 19 # 20 # 18 # 37 # 38 #
query_vertical show slave status;

# End of 4.1 tests
