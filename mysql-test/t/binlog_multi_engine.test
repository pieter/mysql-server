source include/have_blackhole.inc;
source include/have_ndb.inc;

CREATE TABLE t1m (m INT, n INT) ENGINE=MYISAM;
CREATE TABLE t1b (b INT, c INT) ENGINE=BLACKHOLE;
CREATE TABLE t1n (e INT, f INT) ENGINE=NDB;

SET SESSION BINLOG_FORMAT=STATEMENT;

INSERT INTO t1m VALUES (1,1), (1,2), (2,1), (2,2);
INSERT INTO t1b VALUES (1,1), (1,2), (2,1), (2,2);
error ER_BINLOG_STMT_FORMAT_FORBIDDEN;
INSERT INTO t1n VALUES (1,1), (1,2), (2,1), (2,2);

UPDATE t1m, t1b SET m = 2, b = 3 WHERE n = c;
error ER_BINLOG_STMT_FORMAT_FORBIDDEN;
UPDATE t1m, t1n SET m = 2, e = 3 WHERE n = f;
error ER_BINLOG_ENGINES_INCOMPATIBLE;
UPDATE t1n, t1b SET e = 2, b = 3 WHERE f = c;

TRUNCATE t1m;
TRUNCATE t1b;
TRUNCATE t1n;

SET SESSION BINLOG_FORMAT=MIXED;

INSERT INTO t1m VALUES (1,1), (1,2), (2,1), (2,2);
INSERT INTO t1b VALUES (1,1), (1,2), (2,1), (2,2);
INSERT INTO t1n VALUES (1,1), (1,2), (2,1), (2,2);

UPDATE t1m, t1b SET m = 2, b = 3 WHERE n = c;
UPDATE t1m, t1n SET m = 2, e = 3 WHERE n = f;
error ER_BINLOG_ENGINES_INCOMPATIBLE;
UPDATE t1n, t1b SET e = 2, b = 3 WHERE f = c;

TRUNCATE t1m;
TRUNCATE t1b;
TRUNCATE t1n;

SET SESSION BINLOG_FORMAT=ROW;

INSERT INTO t1m VALUES (1,1), (1,2), (2,1), (2,2);
error ER_BINLOG_ROW_FORMAT_FORBIDDEN;
INSERT INTO t1b VALUES (1,1), (1,2), (2,1), (2,2);
INSERT INTO t1n VALUES (1,1), (1,2), (2,1), (2,2);

error ER_BINLOG_ROW_FORMAT_FORBIDDEN;
UPDATE t1m, t1b SET m = 2, b = 3 WHERE n = c;
UPDATE t1m, t1n SET m = 2, e = 3 WHERE n = f;
error ER_BINLOG_ENGINES_INCOMPATIBLE;
UPDATE t1n, t1b SET e = 2, b = 3 WHERE f = c;

TRUNCATE t1m;
TRUNCATE t1b;
TRUNCATE t1n;

source include/show_binlog_events.inc;

DROP TABLE t1m, t1b, t1n;
