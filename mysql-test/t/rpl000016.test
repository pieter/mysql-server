connect (master,localhost,root,,test,0,var/tmp/mysql.sock);
connect (slave,localhost,root,,test,0,var/tmp/mysql-slave.sock);
system cat /dev/null > var/slave-data/master.info;
system chmod 000 var/slave-data/master.info;
connection slave;
!slave start;
system chmod 600 var/slave-data/master.info;
!slave start;
!change master to master_host='127.0.0.1',master_port=9306,master_user='root'; 
reset slave;
!change master to master_host='127.0.0.1',master_port=9306,master_user='root'; 
slave start;
connection master;
drop table if exists t1;
create table t1 (s text);
insert into t1 values('Could not break slave'),('Tried hard');
connection slave;
sleep 2;
select * from t1;
connection master;
flush logs;
drop table if exists t2;
create table t2(m int);
insert into t2 values (34),(67),(123);
flush logs;
sleep 0.3;
show master logs;
purge master logs to 'master-bin.003';
show master logs;
insert into t2 values (65);
connection slave;
sleep 2;
select * from t2;
drop table if exists t1,t2;
