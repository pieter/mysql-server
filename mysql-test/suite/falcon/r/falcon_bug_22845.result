*** Bug #22845 ***
SET @@storage_engine = 'Falcon';
DROP DATABASE IF EXISTS db1;
CREATE DATABASE db1;
USE db1;
# Establish connection conn1
USE db1;
SET @@storage_engine = 'Falcon';
SET @@autocommit = 0;
# Switch to connection default
SET @@autocommit = 0;
CREATE TABLE t1 (a int) PARTITION BY LIST (a) (
PARTITION p1 VALUES IN (1),
PARTITION p2 VALUES IN (2),
PARTITION p3 VALUES IN (null)
);
START TRANSACTION;
# Switch to connection conn1
START TRANSACTION;
INSERT INTO t1 VALUES (2);
# Switch to connection default
ALTER TABLE t1 DROP PARTITION p2;
ERROR HY000: Can't lock file (errno: 212)
# Switch to connection conn1
COMMIT;
# Switch to connection default
ALTER TABLE t1 DROP PARTITION p2;
COMMIT;
SELECT count(*) FROM t1;
count(*)
0
COMMIT;
DROP DATABASE db1;
