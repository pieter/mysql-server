#!/bin/sh
# 2002-01-30 arjen@mysql.com
# Use this to create mysql.xml (the DocBook XML format output of manual.texi)
# Requires makeinfo 4.0c

#create include.texi with version/port #
        echo "@c This file is autogenerated by the Makefile" > include.texi
        echo -n "@set mysql_version " >> include.texi
#        grep "AM_INIT_AUTOMAKE(mysql, " ../configure.in | \
#         sed -e 's;AM_INIT_AUTOMAKE(mysql, ;;' -e 's;);;' >> include.texi
# 2002-04-26 arjen - the below just picks #.# instead of #.#.#-alpha
# (code by mwagner - tnx)
        grep "AM_INIT_AUTOMAKE(mysql, " ../configure.in | \
         perl -p -e 's/AM_INIT_AUTOMAKE\(mysql,\s(\d+\.\d+)\..+/$1/' >> include.texi
        echo -n "@set default_port " >> include.texi
        grep "MYSQL_TCP_PORT_DEFAULT=" ../configure.in | \
         sed -e 's;MYSQL_TCP_PORT_DEFAULT=;;' >> include.texi

# produce DocBook XML
        makeinfo --force --no-ifinfo --docbook -o - manual.texi |\
         Support/docbook-fixup.pl > mysql.xml
    
        # See if the XML output is well-formed
        xmlwf mysql.xml

        # If all is well, keep processing
        cat mysql.xml | Support/colspec-fix.pl | Support/docbook-split;

