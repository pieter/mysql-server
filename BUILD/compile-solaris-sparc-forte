#! /bin/sh

# Assume Forte is installed in /opt/SUNWSpro and ld is installed in
# /usr/ccs/bin

# Example PATH. You will need to use CC from forte, but use GNU for pretty much everything else
# PATH=/opt/SUNWspro/bin:/usr/ccs/bin:/usr/sfw/bin:/opt/csw/bin:$PATH

PREFIX="/usr/local/mysql"
if test -n "$MYSQL_BUILD_PREFIX"
then
  PREFIX="$MYSQL_BUILD_PREFIX"
fi

make -k maintainer-clean || true
/bin/rm -f */.deps/*.P config.cache
 
path=`dirname $0`
. "$path/autorun.sh"

# For "optimal" code for this computer add -fast to EXTRA
# To compile 32/64 bit, uncomment/comment EXTRA_64_BIT

EXTRA_64_BIT="-m64"
EXTRA="-fast"			# Remove comment to target current machine

#
# The following should not need to be touched
#

STD="-mt -D_FORTEC_ $EXTRA $EXTRA_64_BIT"
CC=cc-5.0 CFLAGS="-Xa -xstrconst $STD" \
DTRACEFLAGS='-64' \
CXX=CC CXXFLAGS="-noex $STD" \
./configure --enable-assembler --with-extra-charsets=complex --enable-thread-safe-client --prefix=$PREFIX --with-plugins=max --enable-dtrace

make -j 4
if [ $? = 0 ]
then
  make test
fi
