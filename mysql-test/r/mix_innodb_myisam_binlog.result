drop table if exists ti, tm;
create table ti (a int) type=innodb;
create table tm (a int) type=myisam;
reset master;
begin;
insert into ti values(1);
insert into tm select * from ti;
commit;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(1)
master-bin.001	178	Query	1	79	use test; insert into tm select * from ti
master-bin.001	244	Query	1	244	use test; COMMIT
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(2);
insert into tm select * from ti;
rollback;
Warning:  Some non-transactional changed tables couldn't be rolled back
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(2)
master-bin.001	178	Query	1	79	use test; insert into tm select * from ti
master-bin.001	244	Query	1	244	use test; ROLLBACK
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(3);
savepoint my_savepoint;
insert into ti values(4);
insert into tm select * from ti;
rollback to savepoint my_savepoint;
Warning:  Some non-transactional changed tables couldn't be rolled back
commit;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(3)
master-bin.001	178	Query	1	79	use test; savepoint my_savepoint
master-bin.001	235	Query	1	79	use test; insert into ti values(4)
master-bin.001	294	Query	1	79	use test; insert into tm select * from ti
master-bin.001	360	Query	1	79	use test; rollback to savepoint my_savepoint
master-bin.001	429	Query	1	429	use test; COMMIT
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(5);
savepoint my_savepoint;
insert into ti values(6);
insert into tm select * from ti;
rollback to savepoint my_savepoint;
Warning:  Some non-transactional changed tables couldn't be rolled back
insert into ti values(7);
commit;
select a from ti order by a;
a
5
7
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(5)
master-bin.001	178	Query	1	79	use test; savepoint my_savepoint
master-bin.001	235	Query	1	79	use test; insert into ti values(6)
master-bin.001	294	Query	1	79	use test; insert into tm select * from ti
master-bin.001	360	Query	1	79	use test; rollback to savepoint my_savepoint
master-bin.001	429	Query	1	79	use test; insert into ti values(7)
master-bin.001	488	Query	1	488	use test; COMMIT
delete from ti;
delete from tm;
reset master;
select get_lock("a",10);
get_lock("a",10)
1
begin;
insert into ti values(8);
insert into tm select * from ti;
select get_lock("a",10);
get_lock("a",10)
1
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(8)
master-bin.001	178	Query	1	79	use test; insert into tm select * from ti
master-bin.001	244	Query	1	244	use test; ROLLBACK
delete from ti;
delete from tm;
reset master;
insert into ti values(9);
insert into tm select * from ti;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; insert into ti values(9)
master-bin.001	138	Query	1	138	use test; insert into tm select * from ti
delete from ti;
delete from tm;
reset master;
insert into ti values(10);
begin;
insert into tm select * from ti;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; insert into ti values(10)
master-bin.001	139	Query	1	139	use test; insert into tm select * from ti
insert into ti values(11);
commit;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; insert into ti values(10)
master-bin.001	139	Query	1	139	use test; insert into tm select * from ti
master-bin.001	205	Query	1	205	use test; BEGIN
master-bin.001	245	Query	1	205	use test; insert into ti values(11)
master-bin.001	305	Query	1	305	use test; COMMIT
alter table tm type=INNODB;
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(12);
insert into tm select * from ti;
commit;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(12)
master-bin.001	179	Query	1	79	use test; insert into tm select * from ti
master-bin.001	245	Query	1	245	use test; COMMIT
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(13);
insert into tm select * from ti;
rollback;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(14);
savepoint my_savepoint;
insert into ti values(15);
insert into tm select * from ti;
rollback to savepoint my_savepoint;
commit;
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(14)
master-bin.001	179	Query	1	179	use test; COMMIT
delete from ti;
delete from tm;
reset master;
begin;
insert into ti values(16);
savepoint my_savepoint;
insert into ti values(17);
insert into tm select * from ti;
rollback to savepoint my_savepoint;
insert into ti values(18);
commit;
select a from ti order by a;
a
16
18
show binlog events from 79;
Log_name	Pos	Event_type	Server_id	Orig_log_pos	Info
master-bin.001	79	Query	1	79	use test; BEGIN
master-bin.001	119	Query	1	79	use test; insert into ti values(16)
master-bin.001	179	Query	1	79	use test; insert into ti values(18)
master-bin.001	239	Query	1	239	use test; COMMIT
drop table ti,tm;
