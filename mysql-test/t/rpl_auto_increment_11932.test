#
# Test of auto_increment
# BUG#11932
#
# Test supplied by Are Casilla
#

source include/master-slave.inc;
--disable_warnings
connection master;
drop database if exists t1;
--enable_warnings
create database t1;
use t1;

CREATE TABLE `t` (
  `id` int(10) unsigned NOT NULL auto_increment,
  `fname` varchar(100) default NULL,
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=2 ;

INSERT INTO `t` VALUES (1, 'blablabla');

CREATE TABLE `test3` (
  `id` int(10) NOT NULL auto_increment,
  `comment` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  AUTO_INCREMENT=3 ;

INSERT INTO `test3` VALUES (1, 'testtest 1');
INSERT INTO `test3` VALUES (2, 'test 2');
  
DELIMITER $;
CREATE PROCEDURE simpleproc3 ()
    NOT DETERMINISTIC
    BEGIN
    INSERT INTO t (fname) (SELECT test3.comment FROM test3 WHERE test3.id = '1');
    INSERT INTO t (fname) VALUES('test');
    END
    $
DELIMITER ;$

CALL simpleproc3();

select * from test3;

TRUNCATE TABLE `t`;
CALL simpleproc3();

select * from t;

save_master_pos;
connection slave;
sync_with_master;

use t1;
select * from t;

drop database t1;
