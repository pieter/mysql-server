# Test if master cuts binlog at InnoDB crash's recovery,
# after we crashed intentionally in rpl_crash_binlog_innodb_2a.test
# We need InnoDB in the master, and a debug build in the master.

# We don't use master-slave.inc because it would RESET MASTER.
connect (master,127.0.0.1,root,,test,$MASTER_MYPORT,);
connect (slave,127.0.0.1,root,,test,$SLAVE_MYPORT,);

source include/have_debug.inc
source include/have_innodb.inc
require_os unix ;

connection master;
select * from t1;
insert into t1 values (7);
select * from t1;
save_master_pos;

connection slave;
select * from t1;
start slave;
sync_with_master;
select * from t1;
system chmod ugo+r $MYSQL_TEST_DIR/var/log/master-bin.000002 ;
--replace_result $MYSQL_TEST_DIR MYSQL_TEST_DIR
eval set @a=load_file("$MYSQL_TEST_DIR/var/log/master-bin.000002");
select length(@a);
select @a like "%values (5)%";

connection master;
drop table if exists t1;
sync_slave_with_master;
